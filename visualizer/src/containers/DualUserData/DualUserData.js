import React, { useEffect, useState, useMemo } from 'react';

import { Row, Col } from 'antd';
import { useParams } from 'react-router-dom';

import styles from './DualUserData.module.scss';

import CDRDataTable from '../../components/Charts/CDRDataTable';

import MultiDataChat from '../../components/Charts/MultiDataChart';

import Header from '../../components/Header/Header';

const dummy = {
  cdr: [
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
    {
      id: 2856,
      timestamp: '2020-07-26 19:58:12.665214',
      from_number: '8247007911',
      to_number: '7363603685',
      duration: 307,
      call_type: 'IN',
      imei: '352009000000006.0',
      imsi: '405000000000008.0',
      cell_id: '88-54133',
      location_lat: 24.699254,
      location_long: 80.110511,
    },
  ],
  activity: {},
};

const DualUser = () => {
  const { id1, id2 } = useParams();

  const [data, updateData] = useState(dummy);

  const { cdr, activity } = data;

  const cdrMap = useMemo(() => {
    const map = {};
    cdr.map((val) => {
      const time = new Date(
        Date.parse(val.timestamp) - (Date.parse(val.timestamp) % 86400000),
      ).toISOString();
      console.log(time);
      map[time] = {
        duration: (map[time] ? map[time].duration : 0) + val.duration,
        frequency: (map[time] ? map[time].frequency : 0) + 1,
      };
    });
    return map;
  }, [cdr]);

  console.log(cdrMap);

  if (data == null) {
    return <Header title="Two User Analysis" />;
  }

  return (
    <>
      <Header title="User Analysis" />
      <Row justify="center">
        <Col span={23}>
          <Row justify="space-around">
            <Col span={6}>
              <a href={`/map/${id1}`}>
                <div className={styles.name}>Show First User's Timeline</div>
              </a>
            </Col>
            <Col span={6}>
              <a href={`/map/${id2}`}>
                <div className={styles.name}>Show Second User's Timeline</div>
              </a>
            </Col>
          </Row>
          <Row justify="space-around" align="center">
            <Col span={13}>
              <div className={styles.tableContainer}>
                <CDRDataTable data={cdr} />
              </div>
            </Col>
            <Col span={11}>
              <Row>
                <div className={styles.chartContainer}>
                  <MultiDataChat
                    data={cdrMap}
                    height={530}
                    width={600}
                    id="CDR"
                    title="Day Wise Calls"
                  />
                </div>
              </Row>
              <Row>
                <div className={styles.chartContainer}>
                  <MultiDataChat
                    data={activity}
                    height={530}
                    width={600}
                    id="Activity"
                    title="Day Wise User Internet Activity"
                  />
                </div>
              </Row>
            </Col>
          </Row>
        </Col>
      </Row>
    </>
  );
};

export default DualUser;
